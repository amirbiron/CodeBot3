# הפעלת הצפנת טוקנים (מדריך קצר)

מטרה: להפעיל הצפנת טוקני GitHub במסד הנתונים של הבוט באמצעות `TOKEN_ENC_KEY`.

## שלב 1: הפקת מפתח Fernet
אפשר להפיק מפתח בפייתון מקומי או בכל סביבת פייתון שיש לך:

```python
from cryptography.fernet import Fernet
print(Fernet.generate_key().decode())
```

- הפלט הוא מחרוזת base64 (למשל: `enQ1b2...=`). שמור אותה במקום בטוח.

## שלב 2: הגדרת משתנה סביבה
הוסף את המשתנה `TOKEN_ENC_KEY` עם הערך שהתקבל ל-Environment Variables של הסביבה שמריצה את הבוט.

דוגמאות:
- Render / Heroku / VPS: הוסף Environment Variable בשם `TOKEN_ENC_KEY` והדבק את הערך.
- Docker Compose:
  ```yaml
  services:
    bot:
      environment:
        - TOKEN_ENC_KEY=<הדבק כאן את המפתח>
  ```
- קובץ .env (אם נטען אוטומטית אצלך):
  ```env
  TOKEN_ENC_KEY=<הדבק כאן את המפתח>
  ```

## שלב 3: איתחול/הפעלה מחדש של הבוט
לאחר הגדרת המשתנה, הפעל מחדש את השירות. מעכשיו:
- כל טוקן חדש שישמר יישמר מוצפן (יופיע במסד עם prefix `enc:`).
- טוקנים ישנים שנשמרו לפני כן נשארים כפי שהם. אפשר למחוק ולהזין מחדש כדי להצפין.

## שלב 4: אימות
- שמור טוקן GitHub חדש דרך הבוט.
- בדוק במסד הנתונים שבשדה `github_token` הערך מתחיל ב-`enc:`.

## הערות חשובות
- החלפת `TOKEN_ENC_KEY` בעתיד תמנע פענוח של טוקנים שהוצפנו בעזרת המפתח הישן.
- המפתח עצמו רגיש – שמור אותו בכלי סודי (Vault/Secrets Manager) ולא בקוד.
- ללא `TOKEN_ENC_KEY`: הבוט לא מצפין במסד, אך מטשטש טוקנים בלוגים.