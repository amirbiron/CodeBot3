# ğŸ·ï¸ ×¤×™×¦'×¨: Projects / ×§×‘×•×¦×•×ª - ××¨×’×•×Ÿ ×§×‘×¦×™× ×‘×¤×¨×•×™×§×˜×™×

## ğŸ“‹ ×ª×™××•×¨ ×›×œ×œ×™

××¢×¨×›×ª × ×™×”×•×œ ×¤×¨×•×™×§×˜×™× ×©×××¤×©×¨×ª ×œ××¨×’×Ÿ ×§×‘×¦×™× ×§×©×•×¨×™× ×ª×—×ª ×¤×¨×•×™×§×˜ ××—×“. ×”×¤×™×¦'×¨ ××•×¡×™×£ ×©×›×‘×ª ××¨×’×•×Ÿ ××¢×œ ×”×ª×’×™×•×ª ×•×××¤×©×¨ × ×™×”×•×œ ×§×‘×•×¦×•×ª ×©×œ ×§×‘×¦×™× ×‘×¦×•×¨×” ××•×‘× ×™×ª.

### ğŸ¯ ××˜×¨×•×ª ×”×¤×™×¦'×¨
- ××¨×’×•×Ÿ ×§×‘×¦×™× ×§×©×•×¨×™× ×ª×—×ª ×¤×¨×•×™×§×˜ ××—×“
- × ×™×”×•×œ ×¤×¨×•×™×§×˜×™× ×©×œ××™× (×¦×¤×™×™×”, ×™×™×¦×•×, ×’×™×‘×•×™)
- ×”×¤×¨×“×” ×‘×¨×•×¨×” ×‘×™×Ÿ ×¤×¨×•×™×§×˜×™× ×©×•× ×™×
- ×ª××™×›×” ×‘×¢×‘×•×“×” ×¢×œ ××¡×¤×¨ ×¤×¨×•×™×§×˜×™× ×‘××§×‘×™×œ

### ğŸ‘¤ ×ª×¨×—×™×©×™ ×©×™××•×©
1. **Web Developer**: ××¨×’×•×Ÿ ×§×‘×¦×™ Frontend ×•-Backend ×œ×¤×™ ×¤×¨×•×™×§×˜
2. **Student**: ×”×¤×¨×“×” ×‘×™×Ÿ ×ª×¨×’×™×œ×™× ×©×œ ×§×•×¨×¡×™× ×©×•× ×™×
3. **Freelancer**: × ×™×”×•×œ ×§×‘×¦×™× ×©×œ ×œ×§×•×—×•×ª ×©×•× ×™×
4. **Data Scientist**: ××¨×’×•×Ÿ ×¡×§×¨×™×¤×˜×™× ×œ×¤×™ ×¤×¨×•×™×§×˜×™ ××—×§×¨

---

## ğŸ—„ï¸ ××‘× ×” Database

### ×§×•×œ×§×¦×™×” ×—×“×©×”: projects

```python
# ××‘× ×” ××¡××š ×‘×§×•×œ×§×¦×™×” projects

{
    "_id": ObjectId("..."),
    "project_id": "proj_abc123xyz",           # ××–×”×” ×™×™×—×•×“×™
    "user_id": 123456789,                      # ×‘×¢×œ×™×
    "project_name": "WebApp",                  # ×©× ×”×¤×¨×•×™×§×˜
    "display_name": "My Web Application",      # ×©× ×ª×¦×•×’×”
    "description": "Full-stack web app with React and Flask",
    "icon": "ğŸŒ",                              # ××™×™×§×•×Ÿ
    "color": "#3498db",                        # ×¦×‘×¢ ×œ×–×™×”×•×™ ×—×–×•×ª×™
    "tags": ["web", "fullstack", "react"],    # ×ª×’×™×•×ª
    "files": [                                 # ×¨×©×™××ª ×§×‘×¦×™×
        "api.py",
        "database.py",
        "frontend/App.js",
        "frontend/components/Header.js"
    ],
    "file_count": 4,                           # ××¡×¤×¨ ×§×‘×¦×™×
    "total_size": 15420,                       # ×’×•×“×œ ×›×•×œ×œ (bytes)
    "languages": {                             # ×©×¤×•×ª ×‘×¤×¨×•×™×§×˜
        "python": 2,
        "javascript": 2
    },
    "is_active": true,                         # ×¤×¨×•×™×§×˜ ×¤×¢×™×œ
    "is_archived": false,                      # ××¨×›×™×•×Ÿ
    "created_at": ISODate("2024-10-09T10:00:00Z"),
    "updated_at": ISODate("2024-10-09T15:30:00Z"),
    "last_accessed_at": ISODate("2024-10-09T15:30:00Z")
}
```

### ×©×“×” ×—×“×© ×‘×§×•×œ×§×¦×™×™×ª code_snippets

```python
# ×”×•×¡×¤×” ×œ×›×œ ××¡××š ×§×•×“ ×§×™×™×:
{
    # ... ×©×“×•×ª ×§×™×™××™×
    "project_id": "proj_abc123xyz",  # ×”×©×ª×™×™×›×•×ª ×œ×¤×¨×•×™×§×˜ (××•×¤×¦×™×•× ×œ×™)
    "project_name": "WebApp"         # ×©× ×”×¤×¨×•×™×§×˜ (×œ×©××™×œ×ª×•×ª ××”×™×¨×•×ª)
}
```

### ××™× ×“×§×¡×™×

```python
# ×‘-database/manager.py - __init__

# ×§×•×œ×§×¦×™×™×ª ×¤×¨×•×™×§×˜×™×
self.projects_collection = self.db.projects

# ××™× ×“×§×¡ ×¨××©×™
self.projects_collection.create_index([
    ("user_id", 1),
    ("project_name", 1)
], unique=True)  # ×©× ×¤×¨×•×™×§×˜ ×™×™×—×•×“×™ ×œ××©×ª××©

# ××™× ×“×§×¡ ×œ×¤×¨×•×™×§×˜×™× ×¤×¢×™×œ×™×
self.projects_collection.create_index([
    ("user_id", 1),
    ("is_active", 1),
    ("updated_at", -1)
])

# ××™× ×“×§×¡ ×‘×§×•×œ×§×¦×™×™×ª ×”×§×•×“ ×œ×¤×¨×•×™×§×˜×™×
self.collection.create_index([
    ("user_id", 1),
    ("project_id", 1)
])
```

---

## ğŸ’» ××™××•×© ×§×•×“

### 1. ××•×“×œ Project (database/models.py)

```python
from dataclasses import dataclass, field
from datetime import datetime, timezone
from typing import List, Dict, Optional

@dataclass
class Project:
    """××•×“×œ ×¤×¨×•×™×§×˜"""
    project_id: str
    user_id: int
    project_name: str
    display_name: str
    description: str = ""
    icon: str = "ğŸ“"
    color: str = "#3498db"
    tags: List[str] = field(default_factory=list)
    files: List[str] = field(default_factory=list)
    file_count: int = 0
    total_size: int = 0
    languages: Dict[str, int] = field(default_factory=dict)
    is_active: bool = True
    is_archived: bool = False
    created_at: datetime = field(default_factory=lambda: datetime.now(timezone.utc))
    updated_at: datetime = field(default_factory=lambda: datetime.now(timezone.utc))
    last_accessed_at: Optional[datetime] = None
    
    def to_dict(self) -> Dict:
        """×”××¨×” ×œ××™×œ×•×Ÿ"""
        return {
            "project_id": self.project_id,
            "user_id": self.user_id,
            "project_name": self.project_name,
            "display_name": self.display_name,
            "description": self.description,
            "icon": self.icon,
            "color": self.color,
            "tags": self.tags,
            "files": self.files,
            "file_count": self.file_count,
            "total_size": self.total_size,
            "languages": self.languages,
            "is_active": self.is_active,
            "is_archived": self.is_archived,
            "created_at": self.created_at,
            "updated_at": self.updated_at,
            "last_accessed_at": self.last_accessed_at
        }
```

---

### 2. ×¤×•× ×§×¦×™×•×ª Database (database/manager.py)

```python
import secrets
from typing import List, Dict, Optional

def create_project(
    self,
    user_id: int,
    project_name: str,
    display_name: str = None,
    description: str = "",
    icon: str = "ğŸ“",
    tags: List[str] = None
) -> Optional[str]:
    """
    ×™×¦×™×¨×ª ×¤×¨×•×™×§×˜ ×—×“×©
    
    Returns:
        project_id ×× ×”×¦×œ×™×—, None ×× × ×›×©×œ
    """
    try:
        # ×‘×“×™×§×” ×× ×©× ×”×¤×¨×•×™×§×˜ ×ª×¤×•×¡
        existing = self.projects_collection.find_one({
            "user_id": user_id,
            "project_name": project_name
        })
        
        if existing:
            logger.warning(f"×¤×¨×•×™×§×˜ {project_name} ×›×‘×¨ ×§×™×™×")
            return None
        
        project_id = f"proj_{secrets.token_urlsafe(16)}"
        
        project_data = {
            "project_id": project_id,
            "user_id": user_id,
            "project_name": project_name,
            "display_name": display_name or project_name,
            "description": description,
            "icon": icon,
            "color": "#3498db",
            "tags": tags or [],
            "files": [],
            "file_count": 0,
            "total_size": 0,
            "languages": {},
            "is_active": True,
            "is_archived": False,
            "created_at": datetime.now(timezone.utc),
            "updated_at": datetime.now(timezone.utc),
            "last_accessed_at": None
        }
        
        self.projects_collection.insert_one(project_data)
        logger.info(f"×¤×¨×•×™×§×˜ {project_name} × ×•×¦×¨ ×‘×”×¦×œ×—×”")
        return project_id
        
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘×™×¦×™×¨×ª ×¤×¨×•×™×§×˜: {e}")
        return None


def get_user_projects(
    self,
    user_id: int,
    include_archived: bool = False,
    limit: int = 50
) -> List[Dict]:
    """×§×‘×œ×ª ×›×œ ×”×¤×¨×•×™×§×˜×™× ×©×œ ××©×ª××©"""
    try:
        query = {"user_id": user_id}
        if not include_archived:
            query["is_archived"] = False
        
        projects = list(
            self.projects_collection.find(query)
            .sort("updated_at", -1)
            .limit(limit)
        )
        
        for p in projects:
            p["_id"] = str(p["_id"])
        
        return projects
        
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘×§×‘×œ×ª ×¤×¨×•×™×§×˜×™×: {e}")
        return []


def get_project(self, user_id: int, project_name: str) -> Optional[Dict]:
    """×§×‘×œ×ª ×¤×¨×•×™×§×˜ ×¡×¤×¦×™×¤×™"""
    try:
        project = self.projects_collection.find_one({
            "user_id": user_id,
            "project_name": project_name
        })
        
        if project:
            project["_id"] = str(project["_id"])
        
        return project
        
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘×§×‘×œ×ª ×¤×¨×•×™×§×˜: {e}")
        return None


def add_file_to_project(
    self,
    user_id: int,
    project_name: str,
    file_name: str
) -> bool:
    """×”×•×¡×¤×ª ×§×•×‘×¥ ×œ×¤×¨×•×™×§×˜"""
    try:
        project = self.get_project(user_id, project_name)
        if not project:
            logger.warning(f"×¤×¨×•×™×§×˜ {project_name} ×œ× × ××¦×")
            return False
        
        # ×‘×“×™×§×” ×× ×”×§×•×‘×¥ ×§×™×™×
        snippet = self.get_code_snippet(user_id, file_name)
        if not snippet:
            logger.warning(f"×§×•×‘×¥ {file_name} ×œ× × ××¦×")
            return False
        
        # ×‘×“×™×§×” ×× ×”×§×•×‘×¥ ×›×‘×¨ ×‘×¤×¨×•×™×§×˜
        if file_name in project.get("files", []):
            logger.info(f"×§×•×‘×¥ {file_name} ×›×‘×¨ ×‘×¤×¨×•×™×§×˜")
            return True
        
        # ×¢×“×›×•×Ÿ ×”×¤×¨×•×™×§×˜
        project_id = project["project_id"]
        language = snippet.get("programming_language", "unknown")
        code_size = len(snippet.get("code", ""))
        
        # ×¢×“×›×•×Ÿ ××•× ×” ×©×¤×•×ª
        languages = project.get("languages", {})
        languages[language] = languages.get(language, 0) + 1
        
        self.projects_collection.update_one(
            {"user_id": user_id, "project_name": project_name},
            {
                "$push": {"files": file_name},
                "$inc": {
                    "file_count": 1,
                    "total_size": code_size
                },
                "$set": {
                    "languages": languages,
                    "updated_at": datetime.now(timezone.utc)
                }
            }
        )
        
        # ×¢×“×›×•×Ÿ ×”×§×•×‘×¥ ×¢×¦××•
        self.collection.update_one(
            {"user_id": user_id, "file_name": file_name},
            {
                "$set": {
                    "project_id": project_id,
                    "project_name": project_name,
                    "updated_at": datetime.now(timezone.utc)
                }
            }
        )
        
        logger.info(f"×§×•×‘×¥ {file_name} × ×•×¡×£ ×œ×¤×¨×•×™×§×˜ {project_name}")
        return True
        
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘×”×•×¡×¤×ª ×§×•×‘×¥ ×œ×¤×¨×•×™×§×˜: {e}")
        return False


def remove_file_from_project(
    self,
    user_id: int,
    project_name: str,
    file_name: str
) -> bool:
    """×”×¡×¨×ª ×§×•×‘×¥ ××¤×¨×•×™×§×˜"""
    try:
        project = self.get_project(user_id, project_name)
        if not project or file_name not in project.get("files", []):
            return False
        
        snippet = self.get_code_snippet(user_id, file_name)
        if not snippet:
            return False
        
        language = snippet.get("programming_language", "unknown")
        code_size = len(snippet.get("code", ""))
        
        # ×¢×“×›×•×Ÿ ××•× ×” ×©×¤×•×ª
        languages = project.get("languages", {})
        if language in languages:
            languages[language] -= 1
            if languages[language] <= 0:
                del languages[language]
        
        self.projects_collection.update_one(
            {"user_id": user_id, "project_name": project_name},
            {
                "$pull": {"files": file_name},
                "$inc": {
                    "file_count": -1,
                    "total_size": -code_size
                },
                "$set": {
                    "languages": languages,
                    "updated_at": datetime.now(timezone.utc)
                }
            }
        )
        
        # ×”×¡×¨×ª ×”×¤×¨×•×™×§×˜ ××”×§×•×‘×¥
        self.collection.update_one(
            {"user_id": user_id, "file_name": file_name},
            {
                "$unset": {
                    "project_id": "",
                    "project_name": ""
                },
                "$set": {
                    "updated_at": datetime.now(timezone.utc)
                }
            }
        )
        
        logger.info(f"×§×•×‘×¥ {file_name} ×”×•×¡×¨ ××¤×¨×•×™×§×˜ {project_name}")
        return True
        
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘×”×¡×¨×ª ×§×•×‘×¥ ××¤×¨×•×™×§×˜: {e}")
        return False


def get_project_files(self, user_id: int, project_name: str) -> List[Dict]:
    """×§×‘×œ×ª ×›×œ ×”×§×‘×¦×™× ×©×œ ×¤×¨×•×™×§×˜"""
    try:
        project = self.get_project(user_id, project_name)
        if not project:
            return []
        
        file_names = project.get("files", [])
        if not file_names:
            return []
        
        files = list(self.collection.find(
            {
                "user_id": user_id,
                "file_name": {"$in": file_names}
            },
            {
                "file_name": 1,
                "programming_language": 1,
                "tags": 1,
                "note": 1,
                "updated_at": 1,
                "code": 1,
                "_id": 0
            }
        ).sort("file_name", 1))
        
        return files
        
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘×§×‘×œ×ª ×§×‘×¦×™ ×¤×¨×•×™×§×˜: {e}")
        return []


def delete_project(
    self,
    user_id: int,
    project_name: str,
    delete_files: bool = False
) -> bool:
    """
    ××—×™×§×ª ×¤×¨×•×™×§×˜
    
    Args:
        delete_files: ×× True, ×’× ××•×—×§ ××ª ×›×œ ×”×§×‘×¦×™× ×‘×¤×¨×•×™×§×˜
    """
    try:
        project = self.get_project(user_id, project_name)
        if not project:
            return False
        
        if delete_files:
            # ××—×§ ××ª ×›×œ ×”×§×‘×¦×™×
            files = project.get("files", [])
            for file_name in files:
                self.delete_code_snippet(user_id, file_name)
        else:
            # ×¨×§ ×”×¡×¨ ××ª ×”×§×™×©×•×¨ ×œ×¤×¨×•×™×§×˜ ××”×§×‘×¦×™×
            self.collection.update_many(
                {
                    "user_id": user_id,
                    "project_name": project_name
                },
                {
                    "$unset": {
                        "project_id": "",
                        "project_name": ""
                    }
                }
            )
        
        # ××—×§ ××ª ×”×¤×¨×•×™×§×˜
        self.projects_collection.delete_one({
            "user_id": user_id,
            "project_name": project_name
        })
        
        logger.info(f"×¤×¨×•×™×§×˜ {project_name} × ××—×§")
        return True
        
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘××—×™×§×ª ×¤×¨×•×™×§×˜: {e}")
        return False


def archive_project(self, user_id: int, project_name: str) -> bool:
    """×”×¢×‘×¨×ª ×¤×¨×•×™×§×˜ ×œ××¨×›×™×•×Ÿ"""
    try:
        result = self.projects_collection.update_one(
            {"user_id": user_id, "project_name": project_name},
            {
                "$set": {
                    "is_archived": True,
                    "is_active": False,
                    "updated_at": datetime.now(timezone.utc)
                }
            }
        )
        
        return result.modified_count > 0
        
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘××¨×›×•×‘ ×¤×¨×•×™×§×˜: {e}")
        return False


def update_project_access(self, user_id: int, project_name: str):
    """×¢×“×›×•×Ÿ ×–××Ÿ ×’×™×©×” ××—×¨×•×Ÿ ×œ×¤×¨×•×™×§×˜"""
    try:
        self.projects_collection.update_one(
            {"user_id": user_id, "project_name": project_name},
            {"$set": {"last_accessed_at": datetime.now(timezone.utc)}}
        )
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘×¢×“×›×•×Ÿ ×’×™×©×”: {e}")
```

---

### 3. Handler ×œ×¤×¨×•×™×§×˜×™× (projects_handler.py)

×¦×•×¨ ×§×•×‘×¥ ×—×“×©: `projects_handler.py`

```python
"""
××˜×¤×œ ×‘×¤×¨×•×™×§×˜×™× - Projects Handler
"""

import logging
from typing import List, Dict

from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.constants import ParseMode
from telegram.ext import (
    CommandHandler,
    CallbackQueryHandler,
    MessageHandler,
    ConversationHandler,
    ContextTypes,
    filters
)

from database import db
from utils import get_language_emoji
from activity_reporter import create_reporter

logger = logging.getLogger(__name__)

# ×©×œ×‘×™ ×©×™×—×”
PROJECT_NAME, PROJECT_DESC, ADD_FILES = range(3)

reporter = create_reporter(
    mongodb_uri="mongodb+srv://mumin:M43M2TFgLfGvhBwY@muminai.tm6x81b.mongodb.net/?retryWrites=true&w=majority&appName=muminAI",
    service_id="srv-d3ilh4vfte5s7392s000",
    service_name="CodeBot3"
)

# ××™×™×§×•× ×™× ×œ×¤×¨×•×™×§×˜×™×
PROJECT_ICONS = ["ğŸ“", "ğŸŒ", "ğŸ“±", "ğŸ–¥ï¸", "ğŸ¨", "ğŸ”§", "âš™ï¸", "ğŸš€", "ğŸ’¼", "ğŸ“Š"]


async def project_create_start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    ×¤×§×•×“×”: /project_create
    ×”×ª×—×œ×ª ×ª×”×œ×™×š ×™×¦×™×¨×ª ×¤×¨×•×™×§×˜
    """
    reporter.report_activity(update.effective_user.id)
    
    await update.message.reply_text(
        "ğŸ“ <b>×™×¦×™×¨×ª ×¤×¨×•×™×§×˜ ×—×“×©</b>\n\n"
        "×¤×¨×•×™×§×˜ ×××¤×©×¨ ×œ××¨×’×Ÿ ×§×‘×¦×™× ×§×©×•×¨×™× ×ª×—×ª ×©× ××—×“.\n\n"
        "ğŸ“ ×©×œ×— ×©× ×œ×¤×¨×•×™×§×˜ (×‘×× ×’×œ×™×ª, ×œ×œ× ×¨×•×•×—×™×):\n\n"
        "×“×•×’××”: <code>WebApp</code> ××• <code>my_project</code>",
        parse_mode=ParseMode.HTML
    )
    
    return PROJECT_NAME


async def project_create_name(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """×§×‘×œ×ª ×©× ×”×¤×¨×•×™×§×˜"""
    user_id = update.effective_user.id
    project_name = update.message.text.strip()
    
    # ×•×œ×™×“×¦×™×”
    if not project_name.replace("_", "").replace("-", "").isalnum():
        await update.message.reply_text(
            "âŒ ×©× ×”×¤×¨×•×™×§×˜ ×—×™×™×‘ ×œ×”×›×™×œ ×¨×§ ××•×ª×™×•×ª, ××¡×¤×¨×™×, ×§×• ×ª×—×ª×•×Ÿ (_) ×•××§×£ (-)\n\n"
            "× ×¡×” ×©×•×‘:"
        )
        return PROJECT_NAME
    
    # ×‘×“×™×§×” ×× ×§×™×™×
    existing = db.get_project(user_id, project_name)
    if existing:
        await update.message.reply_text(
            f"âš ï¸ ×¤×¨×•×™×§×˜ <code>{project_name}</code> ×›×‘×¨ ×§×™×™×.\n\n"
            "×‘×—×¨ ×©× ××—×¨:",
            parse_mode=ParseMode.HTML
        )
        return PROJECT_NAME
    
    context.user_data["project_name"] = project_name
    
    await update.message.reply_text(
        f"âœ… ×©× ×”×¤×¨×•×™×§×˜: <code>{project_name}</code>\n\n"
        f"ğŸ“ ×¢×›×©×™×• ×©×œ×— ×ª×™××•×¨ ×§×¦×¨ (××• <code>skip</code> ×œ×“×™×œ×•×’):\n\n"
        f"×“×•×’××”: <code>××¤×œ×™×§×¦×™×™×ª Web ×¢× React ×•-Flask</code>",
        parse_mode=ParseMode.HTML
    )
    
    return PROJECT_DESC


async def project_create_description(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """×§×‘×œ×ª ×ª×™××•×¨ ×•×™×¦×™×¨×ª ×”×¤×¨×•×™×§×˜"""
    user_id = update.effective_user.id
    description = update.message.text.strip()
    
    if description.lower() == "skip":
        description = ""
    
    project_name = context.user_data["project_name"]
    
    # ×™×¦×™×¨×ª ×”×¤×¨×•×™×§×˜
    project_id = db.create_project(
        user_id=user_id,
        project_name=project_name,
        display_name=project_name.replace("_", " ").title(),
        description=description,
        icon="ğŸ“"
    )
    
    if not project_id:
        await update.message.reply_text(
            "âŒ ×©×’×™××” ×‘×™×¦×™×¨×ª ×”×¤×¨×•×™×§×˜. × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨."
        )
        context.user_data.clear()
        return ConversationHandler.END
    
    message = (
        f"âœ… <b>×¤×¨×•×™×§×˜ × ×•×¦×¨ ×‘×”×¦×œ×—×”!</b>\n\n"
        f"ğŸ“ ×©×: <code>{project_name}</code>\n"
    )
    
    if description:
        message += f"ğŸ“ ×ª×™××•×¨: {description}\n"
    
    message += (
        f"\nğŸ’¡ <b>×”×•×¡×¤×ª ×§×‘×¦×™× ×œ×¤×¨×•×™×§×˜:</b>\n"
        f"<code>/project_add {project_name} file1.py</code>\n\n"
        f"××•:\n"
        f"<code>/show file.py</code> â† ×•×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ \"×”×•×¡×£ ×œ×¤×¨×•×™×§×˜\""
    )
    
    keyboard = [
        [
            InlineKeyboardButton("â• ×”×•×¡×£ ×§×‘×¦×™×", callback_data=f"proj_add_{project_name}"),
            InlineKeyboardButton("ğŸ“‹ ×¨×©×™××ª ×¤×¨×•×™×§×˜×™×", callback_data="projects_list")
        ]
    ]
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.HTML,
        reply_markup=InlineKeyboardMarkup(keyboard)
    )
    
    context.user_data.clear()
    return ConversationHandler.END


async def projects_list_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    ×¤×§×•×“×”: /projects
    ×”×¦×’×ª ×›×œ ×”×¤×¨×•×™×§×˜×™×
    """
    reporter.report_activity(update.effective_user.id)
    user_id = update.effective_user.id
    
    projects = db.get_user_projects(user_id, include_archived=False)
    
    if not projects:
        await update.message.reply_text(
            "ğŸ’­ <b>××™×Ÿ ×œ×š ×¤×¨×•×™×§×˜×™× ×¢×“×™×™×Ÿ</b>\n\n"
            "ğŸ’¡ ×¦×•×¨ ×¤×¨×•×™×§×˜ ×—×“×©:\n"
            "<code>/project_create</code>",
            parse_mode=ParseMode.HTML
        )
        return
    
    # ×‘× ×™×™×ª ×”×•×“×¢×”
    message_lines = [
        "ğŸ“ <b>×”×¤×¨×•×™×§×˜×™× ×©×œ×š</b>",
        f"ğŸ“Š ×¡×”×´×›: {len(projects)} ×¤×¨×•×™×§×˜×™×\n"
    ]
    
    for idx, proj in enumerate(projects, 1):
        name = proj["project_name"]
        display = proj.get("display_name", name)
        icon = proj.get("icon", "ğŸ“")
        file_count = proj.get("file_count", 0)
        languages = proj.get("languages", {})
        desc = proj.get("description", "")
        
        # ×©×¤×•×ª ×‘×¤×¨×•×™×§×˜
        lang_str = ""
        if languages:
            top_langs = sorted(languages.items(), key=lambda x: x[1], reverse=True)[:2]
            lang_str = " â€¢ ".join([f"{get_language_emoji(l)} {l}" for l, _ in top_langs])
        
        line = f"{idx}. {icon} <b>{display}</b>"
        if desc:
            desc_short = desc[:50] + "..." if len(desc) > 50 else desc
            line += f"\n   ğŸ“ {desc_short}"
        line += f"\n   ğŸ“‚ {file_count} ×§×‘×¦×™×"
        if lang_str:
            line += f" â€¢ {lang_str}"
        
        message_lines.append(line)
    
    message = "\n\n".join(message_lines)
    
    # ×›×¤×ª×•×¨×™×
    keyboard = []
    
    # ×¤×¢×•×œ×•×ª ×›×œ×œ×™×•×ª
    keyboard.append([
        InlineKeyboardButton("â• ×¤×¨×•×™×§×˜ ×—×“×©", callback_data="project_create_btn"),
        InlineKeyboardButton("ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×”", callback_data="projects_stats")
    ])
    
    # ×›×¤×ª×•×¨×™× ×œ×¤×¨×•×™×§×˜×™× (×¢×“ 6)
    proj_buttons = []
    for proj in projects[:6]:
        name = proj["project_name"]
        icon = proj.get("icon", "ğŸ“")
        proj_buttons.append(
            InlineKeyboardButton(
                f"{icon} {name[:15]}",
                callback_data=f"show_proj_{name}"
            )
        )
    
    for i in range(0, len(proj_buttons), 2):
        keyboard.append(proj_buttons[i:i+2])
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.HTML,
        reply_markup=InlineKeyboardMarkup(keyboard)
    )


async def project_add_file_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    ×¤×§×•×“×”: /project_add <project_name> <file_name>
    ×”×•×¡×¤×ª ×§×•×‘×¥ ×œ×¤×¨×•×™×§×˜
    """
    reporter.report_activity(update.effective_user.id)
    user_id = update.effective_user.id
    
    if len(context.args) < 2:
        await update.message.reply_text(
            "â• <b>×”×•×¡×¤×ª ×§×•×‘×¥ ×œ×¤×¨×•×™×§×˜</b>\n\n"
            "×©×™××•×©: <code>/project_add &lt;project&gt; &lt;file&gt;</code>\n\n"
            "×“×•×’××”:\n"
            "<code>/project_add WebApp api.py</code>",
            parse_mode=ParseMode.HTML
        )
        return
    
    project_name = context.args[0]
    file_name = " ".join(context.args[1:])
    
    success = db.add_file_to_project(user_id, project_name, file_name)
    
    if success:
        project = db.get_project(user_id, project_name)
        file_count = project.get("file_count", 0) if project else 0
        
        await update.message.reply_text(
            f"âœ… <b>×§×•×‘×¥ × ×•×¡×£ ×œ×¤×¨×•×™×§×˜!</b>\n\n"
            f"ğŸ“ ×¤×¨×•×™×§×˜: <code>{project_name}</code>\n"
            f"ğŸ“„ ×§×•×‘×¥: <code>{file_name}</code>\n"
            f"ğŸ“Š ×¡×”×´×› ×§×‘×¦×™×: {file_count}",
            parse_mode=ParseMode.HTML
        )
    else:
        await update.message.reply_text(
            f"âŒ ×œ× × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ××ª ×”×§×•×‘×¥.\n"
            f"×•×“× ×©×”×¤×¨×•×™×§×˜ ×•×”×§×•×‘×¥ ×§×™×™××™×."
        )


async def project_show(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    ×¤×§×•×“×”: /project <project_name>
    ×”×¦×’×ª ×¤×¨×˜×™ ×¤×¨×•×™×§×˜
    """
    reporter.report_activity(update.effective_user.id)
    user_id = update.effective_user.id
    
    if not context.args:
        await update.message.reply_text(
            "ğŸ“ <b>×”×¦×’×ª ×¤×¨×•×™×§×˜</b>\n\n"
            "×©×™××•×©: <code>/project &lt;project_name&gt;</code>\n\n"
            "×“×•×’××”:\n"
            "<code>/project WebApp</code>",
            parse_mode=ParseMode.HTML
        )
        return
    
    project_name = " ".join(context.args)
    project = db.get_project(user_id, project_name)
    
    if not project:
        await update.message.reply_text(
            f"âŒ ×¤×¨×•×™×§×˜ <code>{project_name}</code> ×œ× × ××¦×.\n\n"
            "×©×œ×— <code>/projects</code> ×œ×¨×©×™××”.",
            parse_mode=ParseMode.HTML
        )
        return
    
    # ×¢×“×›×•×Ÿ ×–××Ÿ ×’×™×©×”
    db.update_project_access(user_id, project_name)
    
    # ×‘× ×™×™×ª ×”×•×“×¢×”
    icon = project.get("icon", "ğŸ“")
    display = project.get("display_name", project_name)
    desc = project.get("description", "")
    file_count = project.get("file_count", 0)
    total_size = project.get("total_size", 0)
    languages = project.get("languages", {})
    files = project.get("files", [])
    
    message = f"{icon} <b>{display}</b>\n\n"
    
    if desc:
        message += f"ğŸ“ {desc}\n\n"
    
    message += f"ğŸ“Š <b>×¡×˜×˜×™×¡×˜×™×§×”:</b>\n"
    message += f"   ğŸ“‚ {file_count} ×§×‘×¦×™×\n"
    message += f"   ğŸ’¾ {total_size:,} bytes\n"
    
    if languages:
        message += f"\nğŸ”¤ <b>×©×¤×•×ª:</b>\n"
        for lang, count in sorted(languages.items(), key=lambda x: x[1], reverse=True):
            emoji = get_language_emoji(lang)
            message += f"   {emoji} {lang}: {count} ×§×‘×¦×™×\n"
    
    if files:
        message += f"\nğŸ“„ <b>×§×‘×¦×™× ({min(len(files), 10)} ×¨××©×•× ×™×):</b>\n"
        for file_name in files[:10]:
            message += f"   â€¢ <code>{file_name}</code>\n"
        
        if len(files) > 10:
            message += f"   ... ×•×¢×•×“ {len(files) - 10} ×§×‘×¦×™×\n"
    
    # ×›×¤×ª×•×¨×™×
    keyboard = [
        [
            InlineKeyboardButton("ğŸ“„ ×”×¦×’ ×§×‘×¦×™×", callback_data=f"proj_files_{project_name}"),
            InlineKeyboardButton("â• ×”×•×¡×£ ×§×•×‘×¥", callback_data=f"proj_add_{project_name}")
        ],
        [
            InlineKeyboardButton("ğŸ“¥ ×™×™×¦× ZIP", callback_data=f"proj_export_{project_name}"),
            InlineKeyboardButton("âš™ï¸ ×”×’×“×¨×•×ª", callback_data=f"proj_settings_{project_name}")
        ],
        [
            InlineKeyboardButton("ğŸ—‘ï¸ ××—×§ ×¤×¨×•×™×§×˜", callback_data=f"proj_delete_{project_name}")
        ]
    ]
    
    await update.message.reply_text(
        message,
        parse_mode=ParseMode.HTML,
        reply_markup=InlineKeyboardMarkup(keyboard)
    )


async def project_callback_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """××˜×¤×œ ×‘×œ×—×™×¦×•×ª ×¢×œ ×›×¤×ª×•×¨×™×"""
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    data = query.data
    
    if data.startswith("show_proj_"):
        # ×”×¦×’×ª ×¤×¨×•×™×§×˜
        project_name = data.replace("show_proj_", "")
        project = db.get_project(user_id, project_name)
        
        if not project:
            await query.edit_message_text("âŒ ×¤×¨×•×™×§×˜ ×œ× × ××¦×")
            return
        
        db.update_project_access(user_id, project_name)
        
        # ×‘× ×™×™×ª ×”×•×“×¢×” (×‘×“×•××” ×œ-project_show)
        icon = project.get("icon", "ğŸ“")
        display = project.get("display_name", project_name)
        file_count = project.get("file_count", 0)
        
        message = (
            f"{icon} <b>{display}</b>\n\n"
            f"ğŸ“‚ {file_count} ×§×‘×¦×™×\n"
        )
        
        keyboard = [
            [
                InlineKeyboardButton("ğŸ“„ ×§×‘×¦×™×", callback_data=f"proj_files_{project_name}"),
                InlineKeyboardButton("â• ×”×•×¡×£", callback_data=f"proj_add_{project_name}")
            ],
            [
                InlineKeyboardButton("ğŸ”™ ×—×–×•×¨", callback_data="projects_list")
            ]
        ]
        
        await query.edit_message_text(
            message,
            parse_mode=ParseMode.HTML,
            reply_markup=InlineKeyboardMarkup(keyboard)
        )
    
    elif data.startswith("proj_files_"):
        # ×”×¦×’×ª ×§×‘×¦×™ ×¤×¨×•×™×§×˜
        project_name = data.replace("proj_files_", "")
        files = db.get_project_files(user_id, project_name)
        
        if not files:
            await query.edit_message_text(
                f"ğŸ“ ×¤×¨×•×™×§×˜: <code>{project_name}</code>\n\n"
                "ğŸ’­ ××™×Ÿ ×§×‘×¦×™× ×‘×¤×¨×•×™×§×˜ ×¢×“×™×™×Ÿ.",
                parse_mode=ParseMode.HTML
            )
            return
        
        message_lines = [
            f"ğŸ“ <b>×§×‘×¦×™ ×”×¤×¨×•×™×§×˜: {project_name}</b>\n"
        ]
        
        for idx, file in enumerate(files[:15], 1):
            name = file.get("file_name", "")
            lang = file.get("programming_language", "")
            emoji = get_language_emoji(lang)
            message_lines.append(f"{idx}. {emoji} <code>{name}</code>")
        
        if len(files) > 15:
            message_lines.append(f"\n... ×•×¢×•×“ {len(files) - 15} ×§×‘×¦×™×")
        
        message = "\n".join(message_lines)
        
        keyboard = [[
            InlineKeyboardButton("ğŸ”™ ×—×–×•×¨ ×œ×¤×¨×•×™×§×˜", callback_data=f"show_proj_{project_name}")
        ]]
        
        await query.edit_message_text(
            message,
            parse_mode=ParseMode.HTML,
            reply_markup=InlineKeyboardMarkup(keyboard)
        )
    
    elif data.startswith("proj_delete_"):
        # ××—×™×§×ª ×¤×¨×•×™×§×˜
        project_name = data.replace("proj_delete_", "")
        
        keyboard = [
            [
                InlineKeyboardButton("âš ï¸ ×›×Ÿ, ××—×§ ×”×›×œ", callback_data=f"proj_confirm_del_files_{project_name}"),
                InlineKeyboardButton("ğŸ“ ××—×§ ×¨×§ ×¤×¨×•×™×§×˜", callback_data=f"proj_confirm_del_only_{project_name}")
            ],
            [
                InlineKeyboardButton("âŒ ×‘×™×˜×•×œ", callback_data=f"show_proj_{project_name}")
            ]
        ]
        
        await query.edit_message_text(
            f"âš ï¸ <b>××—×™×§×ª ×¤×¨×•×™×§×˜: {project_name}</b>\n\n"
            "×‘×—×¨ ××¤×©×¨×•×ª:\n"
            "â€¢ <b>××—×§ ×”×›×œ</b> - ×’× ×”×¤×¨×•×™×§×˜ ×•×’× ×”×§×‘×¦×™×\n"
            "â€¢ <b>××—×§ ×¨×§ ×¤×¨×•×™×§×˜</b> - ×”×§×‘×¦×™× ×™×™×©××¨×•",
            parse_mode=ParseMode.HTML,
            reply_markup=InlineKeyboardMarkup(keyboard)
        )
    
    elif data.startswith("proj_confirm_del_"):
        # ××™×©×•×¨ ××—×™×§×”
        delete_files = "files" in data
        project_name = data.split("_")[-1]
        
        success = db.delete_project(user_id, project_name, delete_files=delete_files)
        
        if success:
            action = "×•×”×§×‘×¦×™× × ××—×§×•" if delete_files else "× ××—×§ (×”×§×‘×¦×™× × ×©××¨×•)"
            await query.edit_message_text(
                f"âœ… ×¤×¨×•×™×§×˜ <code>{project_name}</code> {action}",
                parse_mode=ParseMode.HTML
            )
        else:
            await query.edit_message_text("âŒ ×©×’×™××” ×‘××—×™×§×”")
    
    elif data == "projects_list":
        # ×—×–×¨×” ×œ×¨×©×™××ª ×¤×¨×•×™×§×˜×™×
        projects = db.get_user_projects(user_id)
        
        if not projects:
            await query.edit_message_text("ğŸ’­ ××™×Ÿ ×¤×¨×•×™×§×˜×™×")
            return
        
        message_lines = ["ğŸ“ <b>×”×¤×¨×•×™×§×˜×™× ×©×œ×š</b>\n"]
        
        for proj in projects[:10]:
            name = proj["project_name"]
            icon = proj.get("icon", "ğŸ“")
            count = proj.get("file_count", 0)
            message_lines.append(f"{icon} <code>{name}</code> ({count} ×§×‘×¦×™×)")
        
        message = "\n".join(message_lines)
        
        keyboard = []
        proj_buttons = []
        for proj in projects[:6]:
            name = proj["project_name"]
            icon = proj.get("icon", "ğŸ“")
            proj_buttons.append(
                InlineKeyboardButton(f"{icon} {name[:12]}", callback_data=f"show_proj_{name}")
            )
        
        for i in range(0, len(proj_buttons), 2):
            keyboard.append(proj_buttons[i:i+2])
        
        await query.edit_message_text(
            message,
            parse_mode=ParseMode.HTML,
            reply_markup=InlineKeyboardMarkup(keyboard)
        )


def setup_projects_handlers(application):
    """×¨×™×©×•× handlers"""
    
    # ConversationHandler ×œ×™×¦×™×¨×ª ×¤×¨×•×™×§×˜
    create_conv = ConversationHandler(
        entry_points=[CommandHandler("project_create", project_create_start)],
        states={
            PROJECT_NAME: [MessageHandler(filters.TEXT & ~filters.COMMAND, project_create_name)],
            PROJECT_DESC: [MessageHandler(filters.TEXT & ~filters.COMMAND, project_create_description)]
        },
        fallbacks=[CommandHandler("cancel", lambda u, c: ConversationHandler.END)]
    )
    
    application.add_handler(create_conv)
    application.add_handler(CommandHandler("projects", projects_list_command))
    application.add_handler(CommandHandler("project", project_show))
    application.add_handler(CommandHandler("project_add", project_add_file_command))
    application.add_handler(CallbackQueryHandler(
        project_callback_handler,
        pattern="^(show_proj_|proj_files_|proj_add_|proj_delete_|proj_confirm_|projects_list)"
    ))
```

---

### 4. ×©×™×œ×•×‘ ×‘-main.py

```python
from projects_handler import setup_projects_handlers

setup_projects_handlers(application)
```

---

### 5. ×©×™×œ×•×‘ ×‘×”×¦×’×ª ×§×•×‘×¥ (bot_handlers.py)

```python
# ×‘×ª×•×š show_command, ×”×•×¡×£ ×›×¤×ª×•×¨ "×”×•×¡×£ ×œ×¤×¨×•×™×§×˜":

# ×§×‘×œ×ª ×¤×¨×•×™×§×˜×™× ×©×œ ×”××©×ª××©
projects = db.get_user_projects(user_id)

keyboard = [
    # ... ×›×¤×ª×•×¨×™× ×§×™×™××™×
    [
        InlineKeyboardButton("ğŸ“ ×”×•×¡×£ ×œ×¤×¨×•×™×§×˜", callback_data=f"add_to_project_{file_name}"),
        InlineKeyboardButton("âœï¸ ×¢×¨×™×›×”", callback_data=f"edit_{file_name}")
    ],
    # ...
]
```

---

## âœ… ×¨×©×™××ª ××©×™××•×ª

- [ ] ×™×¦×™×¨×ª ×§×•×œ×§×¦×™×” projects
- [ ] ×©×“×” project_id ×‘×§×‘×¦×™×
- [ ] ××•×“×œ Project
- [ ] ×¤×•× ×§×¦×™×•×ª DB
- [ ] Handler ×œ×™×¦×™×¨×”
- [ ] Handler ×œ×”×¦×’×”
- [ ] ×”×•×¡×¤×”/×”×¡×¨×” ×©×œ ×§×‘×¦×™×
- [ ] ××—×™×§×ª ×¤×¨×•×™×§×˜
- [ ] ×™×™×¦×•× ×¤×¨×•×™×§×˜
- [ ] ××¨×›×•×‘ ×¤×¨×•×™×§×˜×™×

---

**×¡×™×•× ××“×¨×™×š Projects** ğŸ“
